<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Title</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <th:block th:replace="~{fragments/headFragment}"></th:block>
</head>
<body>
    <th:block th:replace="~{fragments/bodyFragment::header}"></th:block>
    <th:block th:replace="~{fragments/bodyFragment::sidebar}"></th:block>
    <!-- ======= main ======= -->
    <main id="main" class="main">
        <div class="pagetitle">
            <h1>생산계획상세보기</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">메인</a></li>
                    <li class="breadcrumb-item">발주계획</li>
                    <li class="breadcrumb-item">생산계획</li>
                    <li class="breadcrumb-item active">생산계획상세보기</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->

        <section class="section dashboard">
            <div class="row">
                <!--★★★★★★★★★★카드내용★★★★★★★★★★★★-->
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">생산계획</h5>
                            <!-- General Form Elements -->
                            <form>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">생산구분</label>
                                    <div class="col-sm-10">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="division" id="division1" value="product">
                                            <label class="form-check-label" for="division1">
                                                제품
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="division" id="division2" value="unit">
                                            <label class="form-check-label" for="division2">
                                                유닛
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label"><span class="division">제품</span>코드</label>
                                    <div class="col-sm-10">
                                        <div class="input-group mb">
                                            <input type="text" class="form-control" id="divisionCode" disabled>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label"><span class="division">제품</span>명</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="divisionName" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">등록날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" id="productionPlanRegDate" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">생산날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" id="productionPlanDate" disabled>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">조달마감날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" id="productionPlanDeadLine" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label for="productionPlanQuantity" class="col-sm-2 col-form-label">생산수량</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" id="productionPlanQuantity" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">
                                        조달리스트
                                    </label>
                                    <div class="col-sm-10">
                                        <table class="table table-hover">
                                            <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">자재명</th>
                                                <th scope="col">수량(개)</th>
                                                <th scope="col">필요수량(개)</th>
                                                <th scope="col">투입공정</th>
                                                <th scope="col">조달마감일자</th>
                                            </tr>
                                            </thead>
                                            <tbody id="bomList">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-10">
                                        <a href="/plan/productionPlanList"><button type="button" class="btn btn-primary">리스트</button></a>
                                    </div>
                                </div>
                            </form><!-- End General Form Elements -->
                        </div>
                    </div>
                </div>
                <!--여기에 카드랑 내용 넣어주시면 됩니다-->
            </div> <!--End row-->
        </section>
    </main>
    <!-- End #main -->
    <script th:inline="javascript">
        $(document).ready(function (e) {
            var productionPlanCode = [[${productionPlanCode}]];
            $.getJSON("/plan/productionPlanGet/" + productionPlanCode, function(dto) {
                console.log("생산계획 잘 불러오나?"+dto)
                console.log("프로덕트코드값"+dto.productCode)
                console.log("유닛값"+dto.unitCode)
                let division="";
                let divisionName="";
                let divisionCode="";
                if(dto.unitCode) {
                    division = "unit";
                    divisionName = dto.unitName;
                    divisionCode = dto.unitCode;
                }else{
                    division = "product";
                    divisionName = dto.productName;
                    divisionCode = dto.productCode;
                }
                $("input[name='division'][value='" + division + "']").prop('checked', true);
                $("#divisionCode").val(divisionCode);
                $("#divisionName").val(divisionName);
                $("#productionPlanRegDate").val(formatDate(dto.productionPlanRegDate));
                $("#productionPlanDate").val(formatDate(dto.productionPlanDate));
                $("#productionPlanDeadLine").val(formatDate(dto.productionPlanDeadLine));
                $("#productionPlanQuantity").val(dto.productionPlanQuantity);
                console.log(dto.procurementPlanDTOList)
                let str = "";
                $.each(dto.procurementPlanDTOList, function(idx, pDto) {
                    str += '<tr>';
                    str += '<th scope="row">'+(idx+1)+'</th>';
                    str += '<td id="materialName'+(idx+1)+'" data-material-code="'+pDto.materialCode+'">'+pDto.materialName+'</td>';
                    str += '<td id="bomQuantity'+(idx+1)+'">'+pDto.bomQuantity+'</td>';
                    str += '<td id="procurementPlanQuantity'+(idx+1)+'">'+pDto.procurementPlanQuantity+'</td>';
                    str += '<td>'+pDto.bomProcess+'</td>';
                    str += '<td><input type="date" class="form-control" name="procurementPlanDeadLine" id="procurementPlanDeadLine'+(idx+1)+'" value="'+formatDate(pDto.procurementPlanDeadLine)+'" disabled></td>';
                    str += '</tr>';
                });
                $("#bomList").html(str);
            })
        });
    </script>
    <th:block th:replace="~{fragments/bodyFragment::footer}"></th:block>
    <th:block th:replace="~{fragments/bodyFragment::js}"></th:block>
</body>
</html>