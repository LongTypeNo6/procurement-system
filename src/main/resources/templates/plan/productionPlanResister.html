<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Title</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <th:block th:replace="~{/fragments/headFragment}"></th:block>
</head>
<body>
    <th:block th:replace="~{/fragments/bodyFragment::header}"></th:block>
    <th:block th:replace="~{/fragments/bodyFragment::sidebar}"></th:block>
    <!-- ======= main ======= -->
    <main id="main" class="main">
        <div class="pagetitle">
            <h1>생산계획등록</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">메인</a></li>
                    <li class="breadcrumb-item">발주계획</li>
                    <li class="breadcrumb-item active">생산계획</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->

        <section class="section dashboard">
            <div class="row">
                <!--★★★★★★★★★★카드내용★★★★★★★★★★★★-->
                <div class="col-lg-12">

                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">생산계획</h5>
                            <!-- General Form Elements -->
                            <form>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">생산구분</label>
                                    <div class="col-sm-10">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="division" id="division1" value="Product" checked>
                                            <label class="form-check-label" for="division1">
                                                제품
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="division" id="division2" value="Unit">
                                            <label class="form-check-label" for="division2">
                                                유닛
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">자재명</label>
                                    <div class="col-sm-10">
                                        <div class="input-group mb">
                                            <input type="text" class="form-control" id="materialName" required>
                                            <button type="button" class="input-group-text" id="materialSelectionBtn" data-bs-toggle="modal" data-bs-target="#materialSelection">검색</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">제품(유닛)명</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" value="유성3색볼펜" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">등록날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" disabled>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">생산날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" >
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">조달마감날짜</label>
                                    <div class="col-sm-10">
                                        <input type="date" class="form-control" value="2024-08-02">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label for="inputNumber" class="col-sm-2 col-form-label">생산수량</label>
                                    <div class="col-sm-10">
                                        <input type="number" class="form-control" value="50">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">
                                        자재리스트
                                        <button type="button" id="modal-button" data-id="plan-제품" class="btn btn-primary btn-sm"
                                                data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">자재검색</button>
                                    </label>
                                    <div class="col-sm-10">
                                        <table class="table table-hover">
                                            <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">자재명</th>
                                                <th scope="col">수량(개)</th>
                                                <th scope="col">필요수량(개)</th>
                                                <th scope="col">투입공정</th>
                                                <th scope="col">조달마감일자</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <th scope="row">1</th>
                                                <td>펜대</td>
                                                <td><input type="number" value="1" disabled></td>
                                                <td><input type="number" value="50"></td>
                                                <td><input type="text" value="최종조립" disabled></td>
                                                <td><input type="date" value="2024-08-02"></td>
                                            </tr>
                                            <tr>
                                                <th scope="row">2</th>
                                                <td>펜촉</td>
                                                <td><input type="number" value="3" disabled></td>
                                                <td><input type="number" value="150"></td>
                                                <td><input type="text" value="1차조립" disabled></td>
                                                <td><input type="date" value="2024-07-31"></td>
                                            </tr>
                                            <tr>
                                                <th scope="row">3</th>
                                                <td>버튼</td>
                                                <td><input type="number" value="3" disabled></td>
                                                <td><input type="number" value="150"></td>
                                                <td><input type="text" value="2차조립" disabled></td>
                                                <td><input type="date" value="2024-08-01"></td>
                                            </tr>
                                            <tr>
                                                <th scope="row">4</th>
                                                <td>그립</td>
                                                <td><input type="number" value="1" disabled></td>
                                                <td><input type="number" value="50"></td>
                                                <td><input type="text" value="최종조립" disabled></td>
                                                <td><input type="date" value="2024-08-02"></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-sm-10">
                                        <a href="조달계획리스트.html"><button type="button" class="btn btn-primary">저장</button></a>
                                        <a href="조달계획리스트.html"><button type="button" class="btn btn-primary">리스트</button></a>
                                    </div>
                                </div>
                            </form><!-- End General Form Elements -->
                        </div>
                    </div>
                </div>
                <!--여기에 카드랑 내용 넣어주시면 됩니다-->
            </div> <!--End row-->
        </section>
    </main>
    <!-- End #main -->
    <script th:inline="javascript">
        $(document).ready(function (e) {
            $("input[name='division']").change(function() {
                var division = $(this).val();
                console.log("바뀐값은"+division)
            });

            //이하는 나중에수정
            $('#releaseRequestDate').val(todayValue());
            $("#materialSelectionBtn").on("click", function () {
                console.log("검색버튼 클릭됨")
                var selectedCode = null;
                $("#materialSearch").on("input", function () {
                    var keyword = $("#materialSearch").val();
                    console.log("검색 키워드: " + keyword);
                    $.getJSON("/temMaterialcontent/materialList?keyword=" + keyword, function(data) {
                        console.log("검색기능 잘 되나?"+data)
                        var str = "";
                        $.each(data, function(idx, dto) {
                            str += '<li class="list-group-item">';
                            str += '<input class="form-check-input me-1" type="radio" name="gridRadios" value="'+dto.materialCode+'" data-material-name="'+dto.materialName+'" aria-label="...">';
                            str += ' '+dto.materialName;
                            str += '</li>';
                        });
                        $("#materialList").html(str);
                        if (selectedCode) {
                            $("input[name='gridRadios'][value='" + selectedCode + "']").prop("checked", true);
                        }
                        $("input[name='gridRadios']").change(function() {
                            var selectedName = $(this).data('materialName');
                            selectedCode = $(this).val();
                            $("#selectedMaterialFooter").text("선택한 자재: " + selectedName);
                            $("#selectedMaterialFooter").attr("data-material-code",selectedCode);
                        });
                    }).fail(function(jqxhr, textStatus, error) {
                        var err = textStatus + ", " + error;
                        console.log("자재 정보 요청 실패: " + err);
                    });
                })
            })
            $("#materialSubmit").on("click", function () {
                // 풋터에 저장된 선택된 자재명과 자재코드 가져오기
                var selectedName = $("#selectedMaterialFooter").text().replace("선택한 자재: ", "");
                var selectedCode = $("#selectedMaterialFooter").attr("data-material-code");

                if (selectedCode && selectedName) {
                    console.log("선택한 값은 Code:", selectedCode, "Name:", selectedName);
                    // 선택된 값을 input 필드에 설정하는 코드 예시:
                    $("#materialName").val(selectedName);
                    // 추가로 materialCode를 숨겨진 필드에 저장하거나 다른 방법으로 처리 가능
                    $("#materialCode").val(selectedCode); // 숨겨진 필드가 있다고 가정
                    // 모달 창 닫기
                    $("#materialSelection").modal('hide');
                } else {
                    console.log("선택된 값이 없습니다.");
                }
            });
            $.getJSON("/inventorycontent/release/" + releaseCode, function(data) {
                console.log("응답데이터", data);
                $('#materialName').val(data.materialName);
                $('#releaseRequestDept').val(data.releaseRequestDept);
                $('#releaseDesireQuantity').val(data.releaseDesireQuantity);
                $('#releaseDesireDate').val(formatDate(data.releaseDesireDate));
                $('#releaseRequestMemo').val(data.releaseRequestMemo);
            }).fail(function(jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.log("출고요청 정보 요청 실패: " + err);
            });
            $("#saveReleaseRequest").on("click", function () {
                var releaseDTO={
                    releaseCode : releaseCode,
                    releaseRequestDate : parseDate($('#releaseRequestDate').val()),
                    materialCode : $('#materialCode').val(),
                    materialName : $('#materialName').val(),
                    releaseRequestDept : $('#releaseRequestDept').val(),
                    releaseDesireQuantity: $('#releaseDesireQuantity').val(),
                    releaseDesireDate : parseDate($('#releaseDesireDate').val()),
                    releaseRequestMemo: $('#releaseRequestMemo').val()
                }
                console.log("보낼 값은 이러합니다"+releaseDTO)
                $.ajax({
                    url: '/inventorycontent/release/' + releaseCode,
                    type: "POST",
                    data: JSON.stringify(releaseDTO),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("입고 기록 저장 성공: ", result);
                        self.location.reload();
                    }
                });
            });
        });
    </script>


    <th:block th:replace="~{/fragments/bodyFragment::footer}"></th:block>
    <th:block th:replace="~{/fragments/bodyFragment::js}"></th:block>
</body>
</html>